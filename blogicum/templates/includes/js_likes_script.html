<script>
    function getCSRFToken() {
        let cookies = document.cookie.split('; '); // –ü–æ–ª—É—á–∞–µ–º –∫—É–∫–∏ –∫–∞–∫ –º–∞—Å—Å–∏–≤
        for (let cookie of cookies) {
            if (cookie.startsWith('csrftoken=')) {
                return cookie.split('=')[1]; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ CSRF-—Ç–æ–∫–µ–Ω–∞
            }
        }
        return ''; // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
    }
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ "–ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫"
    function initializeLikeButtons() {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ —Å –∫–ª–∞—Å—Å–æ–º "like-button"
        const likeButtons = document.querySelectorAll('.like-button');
    
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —á—Ç–æ–±—ã –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–ª–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
        likeButtons.forEach(button => {
            button.removeEventListener('click', handleLikeButtonClick); // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ
            button.addEventListener('click', handleLikeButtonClick);   // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–Ω–æ–≤–æ
        });
    }
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ª–∞–π–∫–æ–≤
    function handleLikeButtonClick(event) {
        const button = event.currentTarget; // –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
        const postId = button.getAttribute('data-post-id'); // ID –ø–æ—Å—Ç–∞
        const csrfToken = getCSRFToken(); // –ü–æ–ª—É—á–∞–µ–º CSRF —Ç–æ–∫–µ–Ω
        fetch(`/posts/${postId}/like/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken // –ü–µ—Ä–µ–¥–∞–µ–º CSRF —Ç–æ–∫–µ–Ω —Å –∑–∞–ø—Ä–æ—Å–æ–º
            },
        })
        .then(response => response.json()) // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ç–≤–µ—Ç –≤ JSON
        .then(data => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏
            if (data.error) {
                console.error(data.error); // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞, –≤—ã–≤–æ–¥–∏–º –µ—ë –≤ –∫–æ–Ω—Å–æ–ª—å
                return;
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤
            const likeCount = document.querySelector(`#like-count-${postId}`);
            if (likeCount) {
                likeCount.textContent = data.total_likes; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–∞–π–∫–æ–≤
            }
    
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            button.textContent = data.liked ? '‚ù§Ô∏è' : 'ü§ç';
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error); // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –æ—à–∏–±–∫–æ–π, –≤—ã–≤–æ–¥–∏–º –µ—ë
        });
    }
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', initializeLikeButtons);
</script>